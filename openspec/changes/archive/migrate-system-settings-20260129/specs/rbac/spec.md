# RBAC 规范增量

## 新增需求

### 需求：角色创建默认禁用
新建角色时，status **必须** 默认为1（禁用）。角色需显式通过PUT /api/roles/:id/status启用后才能分配给用户。

#### 场景：新增角色
- **前置**：管理员访问角色管理页面
- **操作**：填写角色名称，点击新增
- **预期**：角色成功创建，状态显示为"禁用"
- **验证**：GET /api/roles 返回新角色 status=1

### 需求：角色编辑仅允许禁用状态
角色信息（名称、描述）和权限分配 **必须** 仅在角色处于禁用状态（status=1）时允许操作。启用中的角色 **禁止** 修改。

#### 场景：编辑启用角色
- **前置**：存在status=0的启用角色
- **操作**：PUT /api/roles/:id 修改名称
- **预期**：返回400，消息"角色启用中，无法编辑"

#### 场景：修改启用角色权限
- **前置**：存在status=0的启用角色
- **操作**：PUT /api/roles/:id/permissions 修改权限列表
- **预期**：返回400，消息"角色启用中，无法编辑"

#### 场景：编辑禁用角色
- **前置**：存在status=1的禁用角色
- **操作**：PUT /api/roles/:id 修改名称
- **预期**：成功更新，返回200

### 需求：菜单编辑仅允许禁用状态
菜单信息（名称、排序）**必须** 仅在菜单处于禁用状态（status=1）时允许编辑。启用中的菜单 **禁止** 修改。

#### 场景：编辑启用菜单
- **前置**：存在status=0的启用菜单
- **操作**：PUT /api/menu_management/:id 修改名称
- **预期**：返回400，消息"菜单启用中，无法编辑"

#### 场景：编辑禁用菜单
- **前置**：存在status=1的禁用菜单
- **操作**：PUT /api/menu_management/:id 修改名称
- **预期**：成功更新，返回200

### 需求：菜单排序同级唯一
同一父级（parent_id）下的菜单 sort_order **必须** 唯一，不允许重复。编辑排序时 **必须** 校验唯一性。

#### 场景：编辑菜单排序为已占用值
- **前置**：同parent_id下存在sort_order=2的菜单
- **操作**：编辑另一菜单，将sort_order改为2
- **预期**：返回400，消息"同级菜单中排序已存在"

### 需求：权限数据种植
系统启动前 **必须** 通过种植脚本将完整的菜单树和权限数据写入数据库，包含：
- 全部一级菜单（9条）和二级菜单（13条）
- 全部权限条目（43条），覆盖账号/角色/权限/菜单/学生/教练/订单/商品/品牌/属性/类型等模块
- 种植脚本使用INSERT IGNORE确保幂等性

#### 场景：首次启动种植
- **前置**：数据库menu和permissions表为空
- **操作**：执行 scripts/seed_permissions.sql
- **预期**：menu表填充22条记录，permissions表填充43条记录

#### 场景：重复执行种植
- **前置**：数据库已有种植数据
- **操作**：再次执行 scripts/seed_permissions.sql
- **预期**：无错误，数据不重复
