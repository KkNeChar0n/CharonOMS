# è´¢åŠ¡ç®¡ç†æ¨¡å—æµ‹è¯•æŠ¥å‘Š

**æ¨¡å—**: è´¢åŠ¡ç®¡ç†ï¼ˆæ”¶æ¬¾ç®¡ç† + åˆ†è´¦æ˜ç»†ï¼‰
**æµ‹è¯•æ—¥æœŸ**: 2026-02-03
**æµ‹è¯•çŠ¶æ€**: âœ… åŸºç¡€æµ‹è¯•é€šè¿‡ï¼Œç­‰å¾…åŠŸèƒ½æµ‹è¯•

## ä¸€ã€æµ‹è¯•ç¯å¢ƒ

- **æœåŠ¡åœ°å€**: http://localhost:5001
- **æ•°æ®åº“**: charonoms (MySQL)
- **Goç‰ˆæœ¬**: go1.23.5
- **è®¤è¯æ–¹å¼**: JWT Bearer Token

## äºŒã€å·²å®Œæˆæµ‹è¯•

### 2.1 ç¼–è¯‘æµ‹è¯• âœ…

**æµ‹è¯•é¡¹**: Goç¨‹åºç¼–è¯‘
```bash
cd "D:\claude space\CharonOMS"
go build -o charonoms.exe cmd/main.go
```

**ç»“æœ**: âœ… ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯


### 2.2 æœåŠ¡å¯åŠ¨æµ‹è¯• âœ…

**æµ‹è¯•é¡¹**: æœåŠ¡æ­£å¸¸å¯åŠ¨å¹¶ç›‘å¬ç«¯å£

**ç»“æœ**: âœ… æœåŠ¡å¯åŠ¨æˆåŠŸ
- ç›‘å¬ç«¯å£: 5001
- æ—¥å¿—è¾“å‡ºæ­£å¸¸
- æ•°æ®åº“è¿æ¥æˆåŠŸ

**æœåŠ¡æ—¥å¿—**:
```
[GIN-debug] GET    /api/payment-collections
[GIN-debug] POST   /api/payment-collections
[GIN-debug] PUT    /api/payment-collections/:id/confirm
[GIN-debug] DELETE /api/payment-collections/:id
[GIN-debug] GET    /api/separate-accounts
```


### 2.3 è·¯ç”±æ³¨å†Œæµ‹è¯• âœ…

**æµ‹è¯•é¡¹**: è´¢åŠ¡æ¨¡å—è·¯ç”±æ­£ç¡®æ³¨å†Œ

**æµ‹è¯•æ–‡ä»¶**: `test/api_check.go`

**æµ‹è¯•ç»“æœ**:
| ç«¯ç‚¹ | æ–¹æ³• | çŠ¶æ€ç  | å“åº” | ç»“æœ |
|------|------|--------|------|------|
| /api/payment-collections | GET | 401 | {"code":401,"message":"æœªç™»å½•"} | âœ… |
| /api/payment-collections | POST | 401 | {"code":401,"message":"æœªç™»å½•"} | âœ… |
| /api/separate-accounts | GET | 401 | {"code":401,"message":"æœªç™»å½•"} | âœ… |

**ç»“è®º**: æ‰€æœ‰ç«¯ç‚¹æ­£ç¡®è¿”å›401ï¼ˆéœ€è¦è®¤è¯ï¼‰ï¼Œç¬¦åˆé¢„æœŸ


### 2.4 æ•°æ®åº“ç»“æ„æµ‹è¯• âœ…

**æµ‹è¯•é¡¹**: æ•°æ®åº“è¡¨ç»“æ„éªŒè¯

**payment_collection è¡¨**:
```sql
DESCRIBE payment_collection;
```

**ç»“æœ**: âœ… è¡¨ç»“æ„å®Œæ•´
- ä¸»é”®: id (auto_increment)
- å¤–é”®: order_id, student_id
- ç´¢å¼•: payment_scenario, status
- å­—æ®µ: payment_amount (decimal(10,2)), payer, merchant_order, etc.
- è®°å½•æ•°: 0 (æ–°å®‰è£…)

**separate_account è¡¨**:
```sql
DESCRIBE separate_account;
```

**ç»“æœ**: âœ… è¡¨ç»“æ„å®Œæ•´
- ä¸»é”®: id (auto_increment)
- å¤–é”®: orders_id, childorders_id, payment_id
- ç´¢å¼•: payment_id, payment_type, type
- å­—æ®µ: separate_amount (decimal(10,2)), goods_name, etc.
- è®°å½•æ•°: 0 (æ–°å®‰è£…)


### 2.5 å“åº”æ ¼å¼æµ‹è¯• âœ…

**æµ‹è¯•é¡¹**: APIå“åº”æ ¼å¼ç¬¦åˆè§„èŒƒ

**é¢„æœŸæ ¼å¼**:
```json
{
  "code": 0,
  "message": "success",
  "data": {}
}
```

**æµ‹è¯•ç»“æœ**: âœ… æ‰€æœ‰ç«¯ç‚¹è¿”å›æ ‡å‡†æ ¼å¼
```json
{
  "code": 401,
  "message": "æœªç™»å½•"
}
```


## ä¸‰ã€å¾…å®Œæˆæµ‹è¯•

### 3.1 åŠŸèƒ½æµ‹è¯• â³

**å‰ç½®æ¡ä»¶**: éœ€è¦æœ‰æ•ˆçš„JWT token

**æµ‹è¯•æ¡†æ¶**: `test/financial_integration.go`

**æµ‹è¯•åœºæ™¯**:

#### åœºæ™¯1: åˆ›å»ºæ”¶æ¬¾
- è¾“å…¥: è®¢å•IDã€å­¦å‘˜IDã€æ”¯ä»˜é‡‘é¢ç­‰
- éªŒè¯: æ”¶æ¬¾è®°å½•åˆ›å»ºæˆåŠŸ
- éªŒè¯: çŠ¶æ€ä¸º"æœªæ ¸éªŒ"(10)

#### åœºæ™¯2: ç¡®è®¤åˆ°è´¦
- è¾“å…¥: æ”¶æ¬¾ID
- éªŒè¯: çŠ¶æ€æ›´æ–°ä¸º"å·²æ”¯ä»˜"(20)
- éªŒè¯: åˆ°è´¦æ—¶é—´å·²è®°å½•
- éªŒè¯: è®¢å•çŠ¶æ€æ›´æ–°
- éªŒè¯: è‡ªåŠ¨ç”Ÿæˆåˆ†è´¦æ˜ç»†

#### åœºæ™¯3: åˆ†è´¦æ˜ç»†ç”Ÿæˆ
- éªŒè¯: æŒ‰å­è®¢å•é¡ºåºåˆ†è´¦
- éªŒè¯: é‡‘é¢åˆ†é…æ­£ç¡®
- éªŒè¯: ä¸é‡å¤ç”Ÿæˆï¼ˆå¹‚ç­‰æ€§ï¼‰

#### åœºæ™¯4: æŸ¥è¯¢åŠŸèƒ½
- æµ‹è¯•: æŒ‰è®¢å•IDæŸ¥è¯¢æ”¶æ¬¾
- æµ‹è¯•: æŒ‰æ”¶æ¬¾IDæŸ¥è¯¢åˆ†è´¦æ˜ç»†
- æµ‹è¯•: åˆ†é¡µæŸ¥è¯¢

#### åœºæ™¯5: åˆ é™¤åŠŸèƒ½
- æµ‹è¯•: è½¯åˆ é™¤æ”¶æ¬¾è®°å½•
- éªŒè¯: å…³è”æ•°æ®å¤„ç†


### 3.2 æ€§èƒ½æµ‹è¯• â³

- å¹¶å‘åˆ›å»ºæ”¶æ¬¾æµ‹è¯•
- å¤§é‡æ•°æ®æŸ¥è¯¢æ€§èƒ½
- åˆ†è´¦è®¡ç®—æ•ˆç‡


### 3.3 å¼‚å¸¸æµ‹è¯• â³

- æ— æ•ˆè®¢å•ID
- é‡‘é¢è¶…å‡ºèŒƒå›´
- é‡å¤ç¡®è®¤åˆ°è´¦
- å¹¶å‘ç¡®è®¤å†²çª


## å››ã€å¦‚ä½•è¿è¡Œå®Œæ•´æµ‹è¯•

### æ–¹æ³•1: ä½¿ç”¨é›†æˆæµ‹è¯•è„šæœ¬

1. è·å–JWT Token:
```bash
# å¯ç”¨æµ‹è¯•è´¦å·:
# - admin (role_id: 1)
# - manager (role_id: 2)
# - operator (role_id: 3)
# - charon (role_id: 1001)

# é€šè¿‡æµè§ˆå™¨ç™»å½•åä»å¼€å‘è€…å·¥å…·è·å–token
# æˆ–ä½¿ç”¨ç™»å½•APIè·å–
```

2. è®¾ç½®ç¯å¢ƒå˜é‡:
```bash
export TEST_JWT_TOKEN="your-jwt-token-here"
```

3. è¿è¡Œæµ‹è¯•:
```bash
cd "D:\claude space\CharonOMS"
go run test/financial_integration.go
```

### æ–¹æ³•2: ä½¿ç”¨Bashè„šæœ¬

```bash
cd "D:\claude space\CharonOMS"
bash test_financial_api.sh
```

### æ–¹æ³•3: ä½¿ç”¨Postman/curl

å‚è€ƒ `test_financial_api.sh` ä¸­çš„curlå‘½ä»¤


## äº”ã€æµ‹è¯•è¦†ç›–ç‡

| æ¨¡å— | å•å…ƒæµ‹è¯• | é›†æˆæµ‹è¯• | çŠ¶æ€ |
|------|---------|---------|------|
| Domain - Payment | âŒ å¾…è¡¥å…… | â³ å¾…è¿è¡Œ | - |
| Domain - Separate | âŒ å¾…è¡¥å…… | â³ å¾…è¿è¡Œ | - |
| Application - Payment | âŒ å¾…è¡¥å…… | â³ å¾…è¿è¡Œ | - |
| Application - Separate | âŒ å¾…è¡¥å…… | â³ å¾…è¿è¡Œ | - |
| Infrastructure - Repository | âŒ å¾…è¡¥å…… | â³ å¾…è¿è¡Œ | - |
| Interfaces - HTTP Handler | âŒ å¾…è¡¥å…… | â³ å¾…è¿è¡Œ | - |


## å…­ã€å·²çŸ¥é—®é¢˜

æš‚æ— 


## ä¸ƒã€æµ‹è¯•ç»“è®º

### å½“å‰çŠ¶æ€
âœ… **åŸºç¡€æ¶æ„æµ‹è¯•é€šè¿‡**
- ä»£ç ç¼–è¯‘æ— è¯¯
- æœåŠ¡å¯åŠ¨æ­£å¸¸
- è·¯ç”±æ­£ç¡®æ³¨å†Œ
- æ•°æ®åº“è¡¨ç»“æ„å®Œæ•´
- è®¤è¯ä¸­é—´ä»¶å·¥ä½œæ­£å¸¸

â³ **ç­‰å¾…åŠŸèƒ½æµ‹è¯•**
- éœ€è¦JWT tokenå®Œæˆå®Œæ•´åŠŸèƒ½æµ‹è¯•
- é›†æˆæµ‹è¯•æ¡†æ¶å·²å°±ç»ª
- æµ‹è¯•ç”¨ä¾‹å·²å‡†å¤‡


### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å¯åš**:
   - è·å–JWT token
   - è¿è¡Œ `test/financial_integration.go`
   - éªŒè¯å®Œæ•´ä¸šåŠ¡æµç¨‹

2. **åç»­è¡¥å……**:
   - ç¼–å†™å•å…ƒæµ‹è¯•
   - è¡¥å……è¾¹ç•Œæµ‹è¯•
   - æ€§èƒ½å‹æµ‹
   - å½’æ¡£OpenSpecææ¡ˆ


### é£é™©è¯„ä¼°

**ä½é£é™©** ğŸŸ¢
- ä»£ç ç»“æ„ç¬¦åˆDDDæ¶æ„
- æ•°æ®åº“ç»“æ„å·²éªŒè¯
- è·¯ç”±å’Œä¸­é—´ä»¶å·¥ä½œæ­£å¸¸
- ä¾èµ–æ³¨å…¥æ­£ç¡®é…ç½®

**å»ºè®®**: è·å–tokenåç«‹å³è¿›è¡ŒåŠŸèƒ½æµ‹è¯•ï¼ŒéªŒè¯ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§ã€‚
